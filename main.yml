---
- hosts: localhost
  gather_facts: no
  vars_prompt:
  - name: "vps"
    prompt: "VPS"
    private: no
  tasks:
    - add_host:
        name: "{{ vps }}"
        groups: dynamically_created_hosts


- hosts: dynamically_created_hosts

  vars_prompt:
    - name: "domain"
      prompt: "Domain name"
      private: no

    - name: "user"
      prompt: "System user"
      private: no

    - name: "password"
      prompt: "System password"
      encrypt: "sha512_crypt"
      private: yes

    - name: "mysql_user"
      prompt: "MySQL user"
      private: no

    - name: "mysql_db"
      prompt: "MySQL DB"
      private: no

    - name: "mysql_password"
      prompt: "MySQL password"
      private: yes

    - name: "mysql_root_password"
      prompt: "MySQL root password"
      private: yes

    - name: "install_mysql"
      prompt: "Would you like to install MySQL server"
      default: false

    - name: "install_apache_php"
      prompt: "Would you like to install Apache & php"
      default: false

    - name: "install_composer"
      prompt: "Would you like to install composer"
      default: false

    - name: "install_grunt"
      prompt: "Would you like to install sass, less & grunt"
      default: false

  pre_tasks:
    - include: "system.yml"

  roles:
    - { role: ezyatev.apache-php, when: install_apache_php and domain and user and password }
    - { role: geerlingguy.composer, when: install_composer and user and password }
    - { role: geerlingguy.mysql, when: install_mysql and mysql_user and mysql_db and mysql_password }
    - { role: gotansible.nodejs, when: install_grunt and user and password }
    - { role: AsianChris.rubygems, when: install_grunt and user and password }
    - { role: manala.npm, when: install_grunt and user and password }

  tasks:
    - include: "user.yml"
      when: user and password

    - include: "apache.yml"
      when: install_apache_php and domain and user and password

    - include: "grunt.yml"
      when: install_grunt and user and password